# 前言部分

## 前言

多年前，我在亚马逊搜索了一本基于 Python 的应用程序安全书。我以为会有多本书可供选择。已经有了很多其他主题的 Python 书籍，如性能、机器学习和 Web 开发。

令我惊讶的是，我搜索的那本书并不存在。我找不到一本关于我和我的同事们正在解决的日常问题的书。我们如何确保所有网络流量都是加密的？我们应该使用哪些框架来保护 Web 应用程序？我们应该用什么算法来对数据进行哈希或签名？

在接下来的几年里，我和我的同事们在确定一套标准的开源工具和最佳实践的同时，找到了这些问题的答案。在此期间，我们设计并实施了几个系统，保护了数百万新用户的数据和隐私。与此同时，有三家竞争对手遭受了黑客攻击。

像世界上其他人一样，我的生活在 2020 年初发生了变化。每条头条新闻都是关于 COVID-19 的，突然间远程工作成为了新常态。我认为可以说，每个人对这场大流行都有自己独特的反应；对我来说，是严重的无聊。

写这本书让我一举两得。首先，在疫情封锁的一年里，这是一种避免无聊的好方法。作为硅谷的居民，在 2020 年秋天，这个银色光辉在我这里被放大了。在此期间，一连串附近的山火破坏了该州大部分地区的空气质量，许多居民被困在家中。

其次，更重要的是，写这本书是非常令人满意的，因为我找不到可以购买的这本书。像许多硅谷初创公司一样，很多书最初的目的就是获得“作者”或“创始人”这样的头衔。但是，如果一家初创公司或一本书永远不会为他人产生价值，它必须解决现实世界的问题。

我希望这本书能让您解决许多您面临的真实安全问题。

## 致谢

写作需要很多孤独的努力。因此很容易忘记谁帮助了你。我想感谢以下人员帮助我（按我遇到他们的顺序）。

致 Kathryn Berkowitz，感谢你是世界上最好的高中英语老师。对于我造成的麻烦，我深感抱歉。致 Amit Rathore，我的 ThoughtQuitter 同伴，感谢你介绍我认识 Manning。我要感谢 Jay Fields、Brian Goetz 和 Dean Wampler，在我寻找出版商时给予的建议和支持。致 Cary Kempston，感谢你对认证团队的支持。没有实际工作经验，我就不应该写出这样的书。致 Mike Stephens，感谢你看过我的原始“手稿”并看到了潜力。我要感谢 Toni Arritola，我的开发编辑，教会我许多知识。我非常感谢你的反馈，通过它我学到了很多关于技术写作的东西。致我的技术编辑 Michael Jensen，感谢你周到的反馈和快速的交稿时间。你的评论和建议帮助这本书取得了成功。

最后，我要感谢在这一努力的开发阶段给予我时间和反馈的所有 Manning 评论员：Aaron Barton，Adriaan Beiertz，Bobby Lin，Daivid Morgan，Daniel Vasquez，Domingo Salazar，Grzegorz Mika，Håvard Wall，Igor van Oostveen，Jens Christian Bredahl Madsen，Kamesh Ganesan，Manu Sareena，Marc-Anthony Taylor，Marco Simone Zuppone，Mary Anne Thygesen，Nicolas Acton，Ninoslav Cerkez，Patrick Regan，Richard Vaughan，Tim van Deurzen，Veena Garapaty 和 William Jamir Silva，你们的建议帮助这本书更上一层楼。

## 关于本书

我用 Python 来教授安全，而不是反过来。换句话说，当你阅读本书时，你将学到更多关于安全而不是 Python 的知识。这有两个原因。首先，安全是复杂的，而 Python 并不是。其次，编写大量的自定义安全代码并不是保护系统的最佳方式；几乎总是应该把繁重的工作委托给 Python、一个库或一个工具。

本书涵盖了初学者和中级安全概念。这些概念是用初级 Python 代码实现的。无论是安全还是 Python 的材料都不是高级的。

### 谁应该阅读这本书

本书中的所有示例都模拟了在现实世界中开发和保护系统的挑战。因此，将代码推送到生产环境的程序员将学到最多。需要具备初级 Python 技能，或者对任何其他主要语言有中级经验。你当然不必是 web 开发人员才能从这本书中学习，但对 web 的基本了解会使吸收后半部分内容变得更容易。

也许你不是构建或维护系统的人；相反，你是测试它们。如果是这样，你将更深入地了解*什么*要测试，但我甚至不会试图教你如何测试。你知道，这是两种不同的技能。

与一些安全书籍不同，这里的例子都不假设攻击者的视角。因此，这个群体将学到最少。如果对他们来说有任何安慰的话，在一些章节中，我会让坏人获胜。

### 本书的组织方式：一份路线图

本书的第一章通过简要介绍安全标准、最佳实践和基础知识来设定期望。剩下的 17 章分为三个部分。

第 1 部分，“密码学基础”，通过少量的密码学概念奠定了基础。这部分内容在第 2 部分和第 3 部分中反复出现。

+   第二章直接介绍了散列和数据完整性的密码学。在讲解的过程中，我介绍了一小组在全书中频繁出现的字符。

+   第三章是从第二章中提取出来的。该章涉及到使用密钥生成和键控散列进行数据验证。

+   第四章涵盖了任何安全书籍都必不可少的两个主题：对称加密和保密性。

+   类似于第三章，第五章也是从其前一章中提取出来的。该章涵盖了非对称加密、数字签名和不可否认性。

+   第六章将前几章的许多主要思想结合起来，形成了一个无处不在的网络协议，传输层安全性。

第 2 部分，“认证和授权”，包含了本书中最具商业价值的材料。该部分以大量关于与安全相关的常见用户工作流的实际操作指导为特点。

+   第七章介绍了 HTTP 会话管理和 Cookies，为后续章节讨论的许多攻击做好了铺垫。

+   第八章完全关于身份，介绍了用户注册和用户认证的工作流程。

+   第九章介绍了密码管理，是我写作过程中最有趣的一章。这部分内容在之前的章节中得到了大量的延伸。

+   第十章从认证转向了授权，介绍了关于权限和用户组的另一个工作流程。

+   第十一章通过 OAuth 结束了第 2 部分，OAuth 是一个为了共享受保护资源而设计的行业标准授权协议。

读者们发现第 3 部分，“抵御攻击”，是本书中最具对抗性的部分。这部分内容更易于理解，也更加刺激。

+   第十二章深入操作系统，涉及到文件系统、外部可执行文件和 Shell 等主题。

+   第十三章教会你如何通过各种输入验证策略来抵制众多的注入攻击。

+   第十四章完全专注于最臭名昭著的所有注入攻击，即跨站脚本攻击。你可能早就预料到了这一点。

+   第十五章介绍了内容安全策略。在某种程度上，这可以被视为关于跨站脚本攻击的附加章节。

+   第十六章介绍了跨站请求伪造。这一章结合了前几章的几个主题，并且遵循了 REST 的最佳实践。

+   第十七章解释了同源策略，以及我们为什么会不时地使用跨源资源共享来放宽同源策略。

+   第十八章以关于点击劫持的内容结束了本书，并提供了一些资源来保持你的技能更新。

### 关于代码

本书包含许多源代码示例，包括编号列表和与普通文本一致的代码。在这两种情况下，源代码都以`固定宽度字体格式`显示，以将其与普通文本分隔开。有时代码也会以**`粗体`**显示，以突出显示从本章的先前步骤更改的代码，例如当新功能添加到现有代码行时。

在许多情况下，原始源代码已经重新格式化；我们添加了换行符并重新调整了缩进以适应书中可用的页面空间。在少数情况下，即使这样还不够，列表中也包含行续标记（➥）。此外，当文本描述代码时，源代码中的注释通常已从列表中删除。代码注释伴随着许多列表，突出显示重要概念。

### liveBook 讨论论坛

购买《全栈 Python 安全》包括免费访问 Manning Publications 维护的私人网络论坛，您可以在论坛上发表对书籍的评论，提出技术问题，并从作者和其他用户那里获得帮助。要访问论坛，请访问[`livebook.manning.com/book/practical-python-security/welcome/v-4/`](https://livebook.manning.com/book/practical-python-security/welcome/v-4/)。您还可以在[`livebook.manning.com/#!/discussion`](https://livebook.manning.com/#!/discussion)了解有关 Manning 论坛和行为规则的更多信息。

Manning 对我们的读者的承诺是提供一个场所，个人读者和读者与作者之间可以进行有意义的对话。这并不意味着作者需要承诺任何特定数量的参与，作者对论坛的贡献仍然是自愿的（并且未付费的）。我们建议您尝试向作者提出一些具有挑战性的问题，以免他失去兴趣！只要书籍在印刷中，论坛和以前讨论的存档将可以从出版商的网站访问。

## 关于作者

Dennis Byrne 是 23andMe 架构团队的成员，保护着超过 1000 万客户的基因数据和隐私。在加入 23andMe 之前，Dennis 曾是 LinkedIn 的软件工程师。Dennis 是一名健美运动员和全球水下探险者（GUE）洞穴潜水员。他目前住在硅谷，远离他成长并上学的阿拉斯加。

## 关于封面插图

*全栈 Python 安全*封面上的人物题为“Homme Touralinze”，是西伯利亚一个地区的图茂人。这幅插图选自雅克·格拉塞·德·圣索维尔（Jacques Grasset de Saint-Sauveur）（1757-1810）收集的各国服装集《不同国家的服装》，该书于 1797 年在法国出版。每幅插图都经过精细绘制和手工上色。格拉塞·德·圣索维尔收集的丰富多样性生动地提醒我们，仅仅 200 年前，世界各地的城镇和地区在文化上是多么分隔开的。人们彼此孤立，说着不同的方言和语言。在街上或乡间，仅仅通过他们的着装就能轻易地辨认出他们住在哪里，以及他们的贸易或社会地位。

我们的着装方式自那时起已经发生了变化，地区之间的多样性在当时是如此丰富，但现在已经逐渐消失了。现在很难区分不同大陆的居民，更不用说不同的城镇、地区或国家了。也许我们已经用更加多样化的个人生活换取了文化多样性——当然也换来了更加多样化和快节奏的技术生活。

在如今很难辨别一本电脑书和另一本电脑书的时代，曼宁庆祝计算机行业的创造力和主动性，其书籍封面基于两个世纪前丰富多样的地区生活，由格拉塞·德·圣索维尔（Grasset de Saint-Sauveur）的图片带回到人们的视线中。
